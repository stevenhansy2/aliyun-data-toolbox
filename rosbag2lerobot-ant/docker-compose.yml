version: '3.8'

services:
  rosbag2lerobot-test:
    build:
      context: .
      dockerfile: Dockerfile
      platforms:
        - linux/amd64
    image: rosbag2lerobot:latest
    platform: linux/amd64
    container_name: rosbag2lerobot_test
    volumes:
      - ${BAG_DIR:-./data/bagdir}:/data/bagdir:ro
      - .:/app
      - ./docker_test_output:/test_output
    working_dir: /app
    command: /bin/bash docker_test.sh baseline true
    environment:
      - PYTHONUNBUFFERED=1
      - PYTHONDONTWRITEBYTECODE=1
      - TZ=Asia/Shanghai
    stdin_open: true
    tty: true
    # resource limit for test
    # deploy:
    #   resources:
    #     limits:
    #       memory: 16G
    #     reservations:
    #       memory: 8G
