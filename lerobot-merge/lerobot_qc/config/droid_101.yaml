# LeRobot 数据集质量检测配置文件

# A1: 数据结构规定
expected_features:
  # 相机图像 - 所有相机键统一放置在 observation.images.* 命名空间
  observation.images.wrist_image_left:
    dtype: "video"
    description: "单臂手腕相机"
  observation.images.exterior_image_1_left:
    dtype: "video"
    description: "外部相机1"
  observation.images.exterior_image_2_left:
    dtype: "video"
    description: "外部相机2"

  # 状态观测 - observation.state.*
  observation.state:
    dtype: "float32"
    dim: 8
    description: "机器人臂部关节位置 + 夹爪"

  # 动作 - action.* (命名同 state 一致，只需要将state换为action)
  action:
    dtype: "float32"
    dim: 8
    description: "机器人臂部关节位置 + 夹爪"


# A2: 统计信息检查 - 允许为0的字段白名单（可选）
# 如果某些字段预期就是全0，可以添加到这里避免误报
allow_zero_fields: ["frame_index", "episode_index", "task_index"]

# B1: 异常静止检测参数
static_detection:
  window_sec: 3.0                    # 窗口长度（秒）
  step_sec: 1.0                      # 滑动步长（秒）
  angle_range_threshold: 0.01        # 角度范围阈值（弧度）
  max_static_ratio: 0.50             # 最大静止帧占比（1%）
  # arm 关节列表 - 根据实际机器人配置修改
  arm_joint_keys:
    - "action.arm.position"
    - "observation.state.arm.position"

# B2: 角度域与 Gripper 检查
angle_gripper_check:
  # Gripper 提取规则(支持两种模式)
  gripper_extraction:
    # 模式1: 独立字段(优先尝试)
    # standalone_keys:
    #   - "action.effector.position"
    #   - "observation.state.effector.position"
    
    # 模式2: 从 arm.position 中提取指定维度（可选）
    embedded_rules:
      # 从 action.arm.position 的指定维度索
      # "action.arm.position":
      #   indices: [6, 13]  # 支持负索引
      #   description: "左右夹爪嵌入在双臂数据末尾"
      
      # 也可以指定绝对索引
      "observation.state.arm.position":
        indices: [7]  # 或者 [7, 14] 等
        description: "单夹爪配置"

  # Gripper 物理限制(机型特定)
  gripper_min: 0.0
  gripper_max: 1.0

  # 角度字段列表（需要检测角度域）
  angle_keys:
    - "observation.state"
    - "action"

# B3: 原始信号异常检测参数
anomaly_detection:
  fps: 30                            # 采样频率

  # 离群值检测 - MAD (Median Absolute Deviation) 倍数
  angle_mad_k: 3.0
  vel_mad_k: 3.0
  acc_mad_k: 3.0

  # 突变/尖峰检测
  dtheta_thr: 3                    # 一阶差分阈值（弧度）
  d2theta_thr: 20                   # 二阶差分阈值（弧度/帧²）
  min_consecutive: 3                 # 最小连续帧数

  # 抖动/不顺滑检测
  tv_per_sec_thr: 10.0               # 单位时间总变差阈值（弧度/秒）

  # 报告参数
  top_k: 10                          # 报告 Top-K 异常片段

  # 物理限制（可选）- 如果不提供则仅报告分位数
  motor_limits:
    # 示例配置，根据实际机器人参数修改
    # "action.arm.position":
    #   angle_min: -3.14159
    #   angle_max: 3.14159
    #   velocity_max: 3.0
    #   acceleration_max: 10.0

# 全局设置
global:
  # 是否对角度进行 unwrap 处理
  unwrap_angles: true

  # 报告格式
  output_formats:
    - "json"
    - "markdown"

  # 日志级别
  log_level: "INFO"
