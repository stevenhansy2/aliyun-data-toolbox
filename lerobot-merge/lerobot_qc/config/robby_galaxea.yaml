# LeRobot 数据集质量检测配置文件

# A1: 数据结构规定
expected_features:
  # 相机图像 - 所有相机键统一放置在 observation.images.* 命名空间
  observation.images.head_rgb:
    dtype: "video"
    description: "顶部相机"
  observation.images.left_wrist_rgb:
    dtype: "video"
    description: "左腕部相机"
  observation.images.right_wrist_rgb:
    dtype: "video"
    description: "右腕部相机"


  # 状态观测 - observation.state.*
  observation.state.left_arm:
    dtype: "float64"
    dim: 7
    description: "左臂关节位置"

  observation.state.right_arm:
    dtype: "float64"
    dim: 7
    description: "左臂关节位置"
  
  observation.state.chassis:
    dtype: "float64"
    dim: 3
    description: "底盘位置"
  
  observation.state.torso:
    dtype: "float64"
    dim: 4
    description: "躯干关节位置"

  observation.state.left_gripper:
    dtype: "float64"
    dim: 1
    description: "简易夹爪(1+1)"
  
  observation.state.right_gripper:
    dtype: "float64"
    dim: 1
    description: "简易夹爪(1+1)"
  
  # 动作 - action.* (命名同 state 一致，只需要将state换为action)
  action.left_arm:
    dtype: "float64"
    dim: 7
    description: "左臂关节位置"

  action.right_arm:
    dtype: "float64"
    dim: 7
    description: "左臂关节位置"

  action.left_gripper:
    dtype: "float64"
    dim: 1
    description: "简易夹爪(1+1)"
  
  action.right_gripper:
    dtype: "float64"
    dim: 1
    description: "简易夹爪(1+1)"
  action.chassis.velocities:
    dtype: "float64"
    dim: 6
    description: "底盘速度"

# A2: 统计信息检查 - 允许为0的字段白名单（可选）
# 如果某些字段预期就是全0，可以添加到这里避免误报
allow_zero_fields: ["observation.state.torso", "observation.state.chassis", "episode_index", "coarse_task_index", "action.chassis.velocities", "task_index", "action.right_arm", "action.left_arm"]

# B1: 异常静止检测参数
static_detection:
  window_sec: 3.0                    # 窗口长度（秒）
  step_sec: 1.0                      # 滑动步长（秒）
  angle_range_threshold: 0.01        # 角度范围阈值（弧度）
  max_static_ratio: 0.50             # 最大静止帧占比（1%）
  # arm 关节列表 - 根据实际机器人配置修改
  arm_joint_keys:
    - "action.left_arm"
    - "action.right_arm"
    - "observation.state.left_arm"
    - "observation.state.right_arm"

# B2: 角度域与 Gripper 检查
angle_gripper_check:
  # Gripper 字段列表
  gripper_keys:
    # - "action.left_gripper"
    # - "action.right_gripper"
    - "observation.state.left_gripper"
    - "observation.state.right_gripper"
  gripper_min: 0.0
  gripper_max: 100.0

  # 角度字段列表（需要检测角度域）
  angle_keys:
    - "observation.state.left_arm"
    - "observation.state.right_arm"
    - "observation.state.torso"
    # - "action.left_arm"
    # - "action.right_arm"

# B3: 原始信号异常检测参数
anomaly_detection:
  fps: 30                            # 采样频率

  # 离群值检测 - MAD (Median Absolute Deviation) 倍数
  angle_mad_k: 3.0
  vel_mad_k: 3.0
  acc_mad_k: 3.0

  # 突变/尖峰检测
  dtheta_thr: 3                    # 一阶差分阈值（弧度）
  d2theta_thr: 20                   # 二阶差分阈值（弧度/帧²）
  min_consecutive: 3                 # 最小连续帧数

  # 抖动/不顺滑检测
  tv_per_sec_thr: 10.0               # 单位时间总变差阈值（弧度/秒）

  # 报告参数
  top_k: 10                          # 报告 Top-K 异常片段

  # 物理限制（可选）- 如果不提供则仅报告分位数
  motor_limits:
    # 示例配置，根据实际机器人参数修改
    # "action.arm.position":
    #   angle_min: -3.14159
    #   angle_max: 3.14159
    #   velocity_max: 3.0
    #   acceleration_max: 10.0

# 全局设置
global:
  # 是否对角度进行 unwrap 处理
  unwrap_angles: true

  # 报告格式
  output_formats:
    - "json"
    - "markdown"

  # 日志级别
  log_level: "INFO"
